{"componentChunkName":"component---src-templates-blog-post-js","path":"/github-actions-mysql/","result":{"data":{"site":{"siteMetadata":{"title":"Aparna's Personal Space","author":"Aparna Ravindra"}},"markdownRemark":{"id":"97cdd109-0a27-537e-ac1b-6ac5bcfb020a","excerpt":"Github Actions provides a way to automate your software workflows. The most common usage I have come across is the CI and CD pipeline. Continuous Integrationâ€¦","html":"<p>Github Actions provides a way to automate your software workflows. The most common usage I have come across is the CI and CD pipeline. Continuous Integration also includes unit tests and integration tests. Sometimes, we require dependent services temporarily to run integration tests, such as databases, caches and other dependencies. This is made easier with the usage of docker containers. As we know, every workflow run happens in an isolated environment called a \"Runner\". The Runner server can install a container of your choice and make it available through out the job. You can read about it in the official documentation <a href=\"https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions#jobsjob_idservices\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">here</a>. The containers thus created are removed at the end of the job by the Runner.</p>\n<p>Let us walk through an example to understand more. In our example scenario, let us say that we need a MySQL database to run integration tests. Therefore, before the step to run tests, we need a MySQL service created. To create the database, we will use the image available on <a href=\"https://hub.docker.com/_/mysql\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Docker Hub</a>. Checkout the image name and available tags here. Another important thing to observe here is the Environment Variables, particularly the mandatory ones. These environment variables need to be set in the workflow for the container to work as expected.</p>\n<p>For MySQL, we see that for the latest version (8.0.26), the only mandatory parameter is <code class=\"language-text\">MYSQL_ROOT_PASSWORD</code>. However, let us also create a database after server creation. Let us also create another user with password and grant all privileges to this user on the created database.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">services:\n      mysql:\n        image: mysql:latest\n        env:\n          MYSQL_ROOT_PASSWORD: ${{ env.MYSQL_ROOT_PASSWORD }}\n          MYSQL_DATABASE: ${{ env.MYSQL_DB }}\n          MYSQL_USER: ${{ env.MYSQL_USER }}\n          MYSQL_PASSWORD: ${{ env.MYSQL_PASSWORD }}</code></pre></div>\n<p>We need to wait for the service to come up before we start with the test cases. If you are familiar with <a href=\"https://docs.docker.com/engine/reference/commandline/create/#options\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">docker create options</a>, Github provides a way to input these options to docker create command. Let us use that to set health check commands. This is because the image we are using does not come with a health check on its own. Let us use the <code class=\"language-text\">ping</code> command to check if the database is up and running.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">services:\n      mysql:\n        image: mysql:latest\n        env:\n          MYSQL_ROOT_PASSWORD: ${{ env.MYSQL_ROOT_PASSWORD }}\n          MYSQL_DATABASE: ${{ env.MYSQL_DB }}\n          MYSQL_USER: ${{ env.MYSQL_USER }}\n          MYSQL_PASSWORD: ${{ env.MYSQL_PASSWORD }}\n        options: &gt;-\n          --health-cmd=&quot;mysqladmin ping&quot;\n          --health-interval=10s\n          --health-timeout=5s\n          --health-retries=3</code></pre></div>\n<p>Once the service is running, we need a way to connect to it. We will make the service container expose a port so that we will be able to connect to the database from outside the container. This is done by providing the value to <a href=\"https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions#jobsjob_idservicesservice_idports\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">ports</code></a> param. For MySQL, let us expose the port 3306. This can be set in multiple ways. If you are okay with a random container port, you can set the port to <code class=\"language-text\">3306/tcp</code>. The container port is randomly assigned to a free port. You can later find out the port assinged during run-time using the variable <code class=\"language-text\">${{job.services.&lt;service_name&gt;.ports[&#39;3306&#39;]}}</code>. See full example <a href=\"https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions#jobsjob_idservices\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">here</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">services:\n      mysql:\n        image: mysql:latest\n        env:\n          MYSQL_ROOT_PASSWORD: ${{ env.MYSQL_ROOT_PASSWORD }}\n          MYSQL_DATABASE: ${{ env.MYSQL_DB }}\n          MYSQL_USER: ${{ env.MYSQL_USER }}\n          MYSQL_PASSWORD: ${{ env.MYSQL_PASSWORD }}\n        ports:\n          - 3306:3306\n        options: &gt;-\n          --health-cmd=&quot;mysqladmin ping&quot;\n          --health-interval=10s\n          --health-timeout=5s\n          --health-retries=3</code></pre></div>\n<p>That is it. Now your MySQL service is up and running. You can connect to it with <code class=\"language-text\">--host=127.0.0.1</code>. The port in our example is the default 3306. Let us run a small debug step to find out what permissions are set to the user that we set during service creation. I have set the username, password, etc in <a href=\"https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions#jobsjob_idenv\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">env</a> map so that I can reuse it here.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">steps:\n      - name: Debug\n        run: |\n          mysql --host=127.0.0.1 --user=${{ env.MYSQL_USER }} --password=${{ env.MYSQL_PASSWORD }} ${{ env.MYSQL_DB }} &lt;&lt;MY_QUERY\n          SHOW GRANTS;\n          MY_QUERY</code></pre></div>\n<p>The output of this MySQL query was this:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Run mysql --host=127.0.0.1 --user=testuser --*** sample_mysql_test &lt;&lt;MY_QUERY\nWarning: arning] Using a password on the command line interface can be insecure.\nGrants for testuser@%\nGRANT USAGE ON *.* TO `testuser`@`%`\nGRANT ALL PRIVILEGES ON `sample\\\\_mysql\\\\_test`.* TO `testuser`@`%`</code></pre></div>\n<p>There is a warning for the usage of password on CLI. This is expected ðŸ˜‰</p>\n<p>The full workflow thus:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">\nname: MYSQL\non: [push]\n\njobs:\n  debug:\n    runs-on: ubuntu-latest\n    env:\n      MYSQL_USER: testuser\n      MYSQL_DB: sample_mysql_test\n      MYSQL_PASSWORD: ${{ secrets.TEST_DB_PASSWORD }}\n      MYSQL_ROOT_PASSWORD: ${{ secrets.TEST_DB_ROOT_PASSWORD }}\n    services:\n      mysql:\n        image: mysql:8.0\n        env:\n          MYSQL_ROOT_PASSWORD: ${{ env.MYSQL_ROOT_PASSWORD }}\n          MYSQL_DATABASE: ${{ env.MYSQL_DB }}\n          MYSQL_USER: ${{ env.MYSQL_USER }}\n          MYSQL_PASSWORD: ${{ env.MYSQL_PASSWORD }}\n        ports:\n          - 3306:3306\n        options: &gt;-\n          --health-cmd=&quot;mysqladmin ping&quot;\n          --health-interval=10s\n          --health-timeout=5s\n          --health-retries=3\n    steps:\n      - name: Debug\n        run: |\n          mysql --host=127.0.0.1 --user=${{ env.MYSQL_USER }} --password=${{ env.MYSQL_PASSWORD }} ${{ env.MYSQL_DB }} &lt;&lt;MY_QUERY\n          SHOW GRANTS;\n          MY_QUERY\n</code></pre></div>","fields":{"slug":"/github-actions-mysql/"},"frontmatter":{"title":"Github Actions - Using Services with MySQL as Example","date":"2021, Sep 06","tags":["tech","github-actions","mysql"],"memorydata":null,"practicedata":null,"img":{"childImageSharp":{"resize":{"src":"/static/e74da431cb17fcc256ea282063faa93f/47498/actions-mysql-title.jpg","height":497,"width":1200},"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAL/2gAMAwEAAhADEAAAAdOl3Af/xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAEFAn//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAY/An//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAE/IX//2gAMAwEAAgADAAAAEIP/AP/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABYQAAMAAAAAAAAAAAAAAAAAAAABEP/aAAgBAQABPxAc/9k="},"images":{"fallback":{"src":"/blog/static/e74da431cb17fcc256ea282063faa93f/a9a9b/actions-mysql-title.jpg","srcSet":"/blog/static/e74da431cb17fcc256ea282063faa93f/5d8e7/actions-mysql-title.jpg 750w,\n/blog/static/e74da431cb17fcc256ea282063faa93f/23225/actions-mysql-title.jpg 1080w,\n/blog/static/e74da431cb17fcc256ea282063faa93f/c267b/actions-mysql-title.jpg 1366w,\n/blog/static/e74da431cb17fcc256ea282063faa93f/a9a9b/actions-mysql-title.jpg 1920w","sizes":"100vw"},"sources":[{"srcSet":"/blog/static/e74da431cb17fcc256ea282063faa93f/1a64c/actions-mysql-title.avif 750w,\n/blog/static/e74da431cb17fcc256ea282063faa93f/b157a/actions-mysql-title.avif 1080w,\n/blog/static/e74da431cb17fcc256ea282063faa93f/c2470/actions-mysql-title.avif 1366w,\n/blog/static/e74da431cb17fcc256ea282063faa93f/5eb21/actions-mysql-title.avif 1920w","type":"image/avif","sizes":"100vw"},{"srcSet":"/blog/static/e74da431cb17fcc256ea282063faa93f/b07c1/actions-mysql-title.webp 750w,\n/blog/static/e74da431cb17fcc256ea282063faa93f/84d1e/actions-mysql-title.webp 1080w,\n/blog/static/e74da431cb17fcc256ea282063faa93f/73b51/actions-mysql-title.webp 1366w,\n/blog/static/e74da431cb17fcc256ea282063faa93f/ff130/actions-mysql-title.webp 1920w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.4140625}}}}}},"pageContext":{"slug":"/github-actions-mysql/","previous":{"fields":{"slug":"/gatsby-deploy-automation/"},"frontmatter":{"title":"Gatsby - How to automate deployment using Github Actions","tags":["tech","github-actions","gatsby"],"img":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEE/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAcEIgr//xAAWEAEBAQAAAAAAAAAAAAAAAAABECH/2gAIAQEAAQUCMZ//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAY/An//xAAaEAACAgMAAAAAAAAAAAAAAAABEQBBEFFh/9oACAEBAAE/ISQUCqM7esf/2gAMAwEAAgADAAAAEH/P/8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQMBAT8QCf/EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAECAQE/EGf/xAAbEAACAQUAAAAAAAAAAAAAAAABETEAECFBcf/aAAgBAQABPxCUQaGD2iiDBtMK3//Z"},"images":{"fallback":{"src":"/blog/static/b3990de9bdec07eed8c425e31300c745/ec0f4/gatsby-gh-actions-deployment-title.jpg","srcSet":"/blog/static/b3990de9bdec07eed8c425e31300c745/e8389/gatsby-gh-actions-deployment-title.jpg 750w,\n/blog/static/b3990de9bdec07eed8c425e31300c745/f8fbd/gatsby-gh-actions-deployment-title.jpg 1080w,\n/blog/static/b3990de9bdec07eed8c425e31300c745/6950b/gatsby-gh-actions-deployment-title.jpg 1366w,\n/blog/static/b3990de9bdec07eed8c425e31300c745/ec0f4/gatsby-gh-actions-deployment-title.jpg 1920w","sizes":"100vw"},"sources":[{"srcSet":"/blog/static/b3990de9bdec07eed8c425e31300c745/98357/gatsby-gh-actions-deployment-title.webp 750w,\n/blog/static/b3990de9bdec07eed8c425e31300c745/9889c/gatsby-gh-actions-deployment-title.webp 1080w,\n/blog/static/b3990de9bdec07eed8c425e31300c745/e04bd/gatsby-gh-actions-deployment-title.webp 1366w,\n/blog/static/b3990de9bdec07eed8c425e31300c745/1711c/gatsby-gh-actions-deployment-title.webp 1920w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.3885416666666667}}}}},"next":{"fields":{"slug":"/service_mesh/"},"frontmatter":{"title":"Service Mesh and Micro Services","tags":["tech","kubernetes","service-mesh","micro-service","istio"],"img":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAFABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAP/2gAMAwEAAhADEAAAAdekaAf/xAAWEAADAAAAAAAAAAAAAAAAAAABECH/2gAIAQEAAQUCNf8A/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAFhABAQEAAAAAAAAAAAAAAAAAEQEQ/9oACAEBAAE/IYAm/wD/2gAMAwEAAgADAAAAEAff/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGBABAAMBAAAAAAAAAAAAAAAAAQAQYRH/2gAIAQEAAT8QXiWiBrX/2Q=="},"images":{"fallback":{"src":"/blog/static/e5e26c109e33630b93c1754c4191e14c/d3163/service_mesh.jpg","srcSet":"/blog/static/e5e26c109e33630b93c1754c4191e14c/37f21/service_mesh.jpg 750w,\n/blog/static/e5e26c109e33630b93c1754c4191e14c/c1ea9/service_mesh.jpg 1080w,\n/blog/static/e5e26c109e33630b93c1754c4191e14c/e680c/service_mesh.jpg 1366w,\n/blog/static/e5e26c109e33630b93c1754c4191e14c/d3163/service_mesh.jpg 1920w","sizes":"100vw"},"sources":[{"srcSet":"/blog/static/e5e26c109e33630b93c1754c4191e14c/3656b/service_mesh.webp 750w,\n/blog/static/e5e26c109e33630b93c1754c4191e14c/33974/service_mesh.webp 1080w,\n/blog/static/e5e26c109e33630b93c1754c4191e14c/32772/service_mesh.webp 1366w,\n/blog/static/e5e26c109e33630b93c1754c4191e14c/6156c/service_mesh.webp 1920w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.2598958333333333}}}}}}},"staticQueryHashes":["251720178","764694655"]}