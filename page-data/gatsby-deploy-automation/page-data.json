{"componentChunkName":"component---src-templates-blog-post-js","path":"/gatsby-deploy-automation/","result":{"data":{"site":{"siteMetadata":{"title":"Aparna's Personal Space","author":"Aparna Ravindra"}},"markdownRemark":{"id":"f2c6134f-e513-5c79-9a0d-be89b4c9789f","excerpt":"I decided to write this blog with Gatsby and run it on Github Pages because I am on a quest to learn markdown and I like the idea of having version control overâ€¦","html":"<p>I decided to write this blog with Gatsby and run it on Github Pages because I am on a quest to learn markdown and I like the idea of having version control over the articles. Some times I have too many ideas for the articles. Sometimes I am not able to finish the entire article at once and might need to jump between multiple posts. So, I usually start a new article on a new git branch. My articles so far have been unrelated, so I merge the finished articles to the master branch in different orders as and when they are ready.</p>\n<p>One of the goals I have set for myself is to be consistant at writing. This means I will have to frequently publish the articles. For the first few posts, I did manual deployments from my laptop. Now, I have automated the process. As soon as I merge a post to the master branch, a deployment script will publish the website. I have achieved this using <a href=\"https://github.com/features/actions\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Github Actions</a>.</p>\n<p>Setting up the automated deployment involved writing a <code class=\"language-text\">workflow</code>. A workflow is nothing but a sequence of jobs, each involving a sequence of steps. I kept my workflow simple. It consists of a single job with a few steps.</p>\n<h4>Checkout the code</h4>\n<p>The first step, of course, is to checkout the master branch. This is done using the <a href=\"https://github.com/actions/checkout\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">actions/checkout</a> action, which is a pretty standard action everyone uses.</p>\n<h4>Setup Node</h4>\n<p>Next, I have to build the source code. For that I need NodeJS setup in the machine where the job is running. The <a href=\"https://docs.github.com/en/actions/learn-github-actions/introduction-to-github-actions#runners\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">runner</a> is simply a blank server at the time of creation (of course it has the \"runner\" software needed to run the workflow). I use the Github-hosted runner. The default Ubuntu server that Github provides is sufficient for my usecase. I digress. On the runner server, I setup NodeJs using the action <a href=\"https://github.com/actions/setup-node\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">setup-node</a>. This, again, is a fairly common action. It takes as input the node version you need. I use version 14.x</p>\n<h4>Install dependencies</h4>\n<p>The next step is pretty obvious. It is to install the library that the application needs using the command <code class=\"language-text\">npm ci</code>. If you are wondering why I did not use <code class=\"language-text\">npm install</code>, <a href=\"https://www.geeksforgeeks.org/difference-between-npm-i-and-npm-ci-in-node-js/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">this</a> article might help.</p>\n<h4>Build the project and Deploy to Github Pages</h4>\n<p>Yay! we are at the last step. In the <a href=\"https://github.com/joshi-aparna/blog/blob/ba5ae29eaff4932eae3442e83897d7d72e240713/package.json#L57\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">package.json</a> file of the project, I have defined a script for deployment. This script is a combination of two commands; <code class=\"language-text\">gatsby build --prefix-paths</code> (read about it <a href=\"https://www.gatsbyjs.com/docs/how-to/previews-deploys-hosting/path-prefix/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">here</a>) and <code class=\"language-text\">gh-pages -d public</code> (read about it <a href=\"https://www.gatsbyjs.com/docs/how-to/previews-deploys-hosting/how-gatsby-works-with-github-pages/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">here</a>). In the last step of the workflow, I run this command by running the following shell script.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">git remote set-url origin https://git:${GITHUB_TOKEN}@github.com/${GITHUB_REPOSITORY}.git\nnpm run deploy -- -u &quot;github-actions-bot &lt;support+actions@github.com&gt;&quot;</code></pre></div>\n<p>Before running the <code class=\"language-text\">npm</code> command, I have to set the remote url of the repository, which requires a secret <em>GITHUB_TOKEN</em>. This is a secret that is automatically created for you when you enable Github Actions on your repository. Also, the <code class=\"language-text\">npm</code> command needs the information of the user running it. We provide it using the param <code class=\"language-text\">-u</code>. Read about it <a href=\"https://www.npmjs.com/package/gh-pages\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">here</a></p>\n<p>You can find the full workflow <a href=\"https://github.com/joshi-aparna/blog/blob/master/.github/workflows/deploy-ghpage.yaml\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">here</a>.</p>\n<p>And that's it! Everytime I make a change to the master branch, my website is deployed automatically. It helps a lot when all I want to do sometimes is change the \"Read\", \"Watch\" or \"Listen\" links in the sidebar of the blog. By the way, have you checked these out, yet?</p>","fields":{"slug":"/gatsby-deploy-automation/"},"frontmatter":{"title":"Gatsby - How to automate deployment using Github Actions","date":"2021, Sep 01","tags":["tech","github-actions","gatsby"],"memorydata":null,"practicedata":null,"img":{"childImageSharp":{"resize":{"src":"/static/b3990de9bdec07eed8c425e31300c745/47498/gatsby-gh-actions-deployment-title.jpg","height":466,"width":1200},"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEE/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAcEIgr//xAAWEAEBAQAAAAAAAAAAAAAAAAABECH/2gAIAQEAAQUCMZ//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAY/An//xAAaEAACAgMAAAAAAAAAAAAAAAABEQBBEFFh/9oACAEBAAE/ISQUCqM7esf/2gAMAwEAAgADAAAAEH/P/8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQMBAT8QCf/EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAECAQE/EGf/xAAbEAACAQUAAAAAAAAAAAAAAAABETEAECFBcf/aAAgBAQABPxCUQaGD2iiDBtMK3//Z"},"images":{"fallback":{"src":"/blog/static/b3990de9bdec07eed8c425e31300c745/ec0f4/gatsby-gh-actions-deployment-title.jpg","srcSet":"/blog/static/b3990de9bdec07eed8c425e31300c745/e8389/gatsby-gh-actions-deployment-title.jpg 750w,\n/blog/static/b3990de9bdec07eed8c425e31300c745/f8fbd/gatsby-gh-actions-deployment-title.jpg 1080w,\n/blog/static/b3990de9bdec07eed8c425e31300c745/6950b/gatsby-gh-actions-deployment-title.jpg 1366w,\n/blog/static/b3990de9bdec07eed8c425e31300c745/ec0f4/gatsby-gh-actions-deployment-title.jpg 1920w","sizes":"100vw"},"sources":[{"srcSet":"/blog/static/b3990de9bdec07eed8c425e31300c745/888db/gatsby-gh-actions-deployment-title.avif 750w,\n/blog/static/b3990de9bdec07eed8c425e31300c745/62888/gatsby-gh-actions-deployment-title.avif 1080w,\n/blog/static/b3990de9bdec07eed8c425e31300c745/3bffd/gatsby-gh-actions-deployment-title.avif 1366w,\n/blog/static/b3990de9bdec07eed8c425e31300c745/01f89/gatsby-gh-actions-deployment-title.avif 1920w","type":"image/avif","sizes":"100vw"},{"srcSet":"/blog/static/b3990de9bdec07eed8c425e31300c745/98357/gatsby-gh-actions-deployment-title.webp 750w,\n/blog/static/b3990de9bdec07eed8c425e31300c745/9889c/gatsby-gh-actions-deployment-title.webp 1080w,\n/blog/static/b3990de9bdec07eed8c425e31300c745/e04bd/gatsby-gh-actions-deployment-title.webp 1366w,\n/blog/static/b3990de9bdec07eed8c425e31300c745/1711c/gatsby-gh-actions-deployment-title.webp 1920w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.3885416666666667}}}}}},"pageContext":{"slug":"/gatsby-deploy-automation/","previous":{"fields":{"slug":"/gatsby-reuse-react-component/"},"frontmatter":{"title":"Gatsby - How To Reuse React Component","tags":["tech","react","gatsby"],"img":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAQBBf/EABQBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAe/PQDQv/8QAGBAAAgMAAAAAAAAAAAAAAAAAAAIBEiD/2gAIAQEAAQUCElrY/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFxABAAMAAAAAAAAAAAAAAAAAAQARIP/aAAgBAQAGPwKNmf/EABkQAQACAwAAAAAAAAAAAAAAAAERIQAgMf/aAAgBAQABPyFoanHSUPNf/9oADAMBAAIAAwAAABB0D//EABYRAQEBAAAAAAAAAAAAAAAAAAEQIf/aAAgBAwEBPxBNn//EABYRAQEBAAAAAAAAAAAAAAAAAAEREP/aAAgBAgEBPxBK3P/EABoQAQACAwEAAAAAAAAAAAAAAAERQQAQIVH/2gAIAQEAAT8QaoSCQLwID0l0CPaZrd6//9k="},"images":{"fallback":{"src":"/blog/static/b8b46b8dbe136282a1c2f422edd544b0/0b2fc/reuse-component-title.jpg","srcSet":"/blog/static/b8b46b8dbe136282a1c2f422edd544b0/7a0ff/reuse-component-title.jpg 750w,\n/blog/static/b8b46b8dbe136282a1c2f422edd544b0/02fde/reuse-component-title.jpg 1080w,\n/blog/static/b8b46b8dbe136282a1c2f422edd544b0/2b622/reuse-component-title.jpg 1366w,\n/blog/static/b8b46b8dbe136282a1c2f422edd544b0/0b2fc/reuse-component-title.jpg 1920w","sizes":"100vw"},"sources":[{"srcSet":"/blog/static/b8b46b8dbe136282a1c2f422edd544b0/1cb46/reuse-component-title.webp 750w,\n/blog/static/b8b46b8dbe136282a1c2f422edd544b0/3edfd/reuse-component-title.webp 1080w,\n/blog/static/b8b46b8dbe136282a1c2f422edd544b0/f81a7/reuse-component-title.webp 1366w,\n/blog/static/b8b46b8dbe136282a1c2f422edd544b0/1bd06/reuse-component-title.webp 1920w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.43489583333333337}}}}},"next":null}},"staticQueryHashes":["30279731","764694655"]}