{"componentChunkName":"component---src-templates-blog-post-js","path":"/basics-of-hbase/","result":{"data":{"site":{"siteMetadata":{"title":"Aparna's Personal Space","author":"Aparna Ravindra"}},"markdownRemark":{"id":"c2e3929f-e10a-5911-acb9-3e3831c45112","excerpt":"We are all familiar that Hbase is a NoSQL datastore. Let us go one level deeper to understand how it works on a high level. Hbase is a key-value store Everyâ€¦","html":"<p>We are all familiar that Hbase is a NoSQL datastore. Let us go one level deeper to understand how it works on a high level.</p>\n<h1>Hbase is a key-value store</h1>\n<p>Every chunk of data you put in it needs a key that is unique. You can get back this data only if you know what is the key associated with it. Unlike SQL databases, indexes are not possible. For example, if you store student information like this:</p>\n<table>\n<thead>\n<tr>\n<th>UniversitySudentNumber</th>\n<th>StudentInformation</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>2021CS001</td>\n<td>{\"Name\": \"Aparna\", \"Branch\" : \"CSE\", \"City\": \"Bengaluru\" }</td>\n</tr>\n</tbody>\n</table>\n<p>To get the information out of this table, you need to know the <code class=\"language-text\">UniversitySudentNumber</code> that is the key. It is not easy to get information of students belonging to <code class=\"language-text\">CSE</code> branch or from the city \"Bengaluru\".</p>\n<h1>Hbase is a NoSQL datastore</h1>\n<p>If you are familiar with relational databases, you will be familiar with schemas. Since Hbase is a NoSQL store, there is no schema (with a caveat for column families, don't worry about it now). If you want to introduce a new column in the table, just start inserting it. The system won't complain. Usually the application that reads and writes to Hbase will handle any change in the columns while parsing the data. If your application can handle a newly introduced column and can handle the fact that older data will not contain this column, you are golden.</p>\n<h1>Hbase is a columnar datastore</h1>\n<p>In a relational database, the data for a row in stored together on disk. Taking the student example above, if you find the name column, you will see that the branch and city columns are right next it to. The information for a different student might reside somewhere else.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 970px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/d004f695f0a868e2c3bd438c83a6ba0a/a1107/relational_store.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.0164609053498%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAABxrBAf//EABYQAAMAAAAAAAAAAAAAAAAAABARIP/aAAgBAQABBQKGP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABkQAQACAwAAAAAAAAAAAAAAAAEQEQBRYf/aAAgBAQABPyE7jWqlTH//2gAMAwEAAgADAAAAENPP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGRABAQADAQAAAAAAAAAAAAAAAREAEDFB/9oACAEBAAE/EItFDzLc4XuhRpgEVTX/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/blog/static/d004f695f0a868e2c3bd438c83a6ba0a/fc615/relational_store.avif 243w,\n/blog/static/d004f695f0a868e2c3bd438c83a6ba0a/b3175/relational_store.avif 485w,\n/blog/static/d004f695f0a868e2c3bd438c83a6ba0a/006d3/relational_store.avif 970w,\n/blog/static/d004f695f0a868e2c3bd438c83a6ba0a/b52ec/relational_store.avif 1455w,\n/blog/static/d004f695f0a868e2c3bd438c83a6ba0a/44c94/relational_store.avif 1940w,\n/blog/static/d004f695f0a868e2c3bd438c83a6ba0a/0c4ef/relational_store.avif 2266w\"\n              sizes=\"(max-width: 970px) 100vw, 970px\"\n              type=\"image/avif\"\n            /><source\n              srcset=\"/blog/static/d004f695f0a868e2c3bd438c83a6ba0a/0e3e2/relational_store.webp 243w,\n/blog/static/d004f695f0a868e2c3bd438c83a6ba0a/749af/relational_store.webp 485w,\n/blog/static/d004f695f0a868e2c3bd438c83a6ba0a/dbca2/relational_store.webp 970w,\n/blog/static/d004f695f0a868e2c3bd438c83a6ba0a/bda17/relational_store.webp 1455w,\n/blog/static/d004f695f0a868e2c3bd438c83a6ba0a/0dc73/relational_store.webp 1940w,\n/blog/static/d004f695f0a868e2c3bd438c83a6ba0a/4b6df/relational_store.webp 2266w\"\n              sizes=\"(max-width: 970px) 100vw, 970px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/blog/static/d004f695f0a868e2c3bd438c83a6ba0a/3f316/relational_store.jpg 243w,\n/blog/static/d004f695f0a868e2c3bd438c83a6ba0a/0d3a1/relational_store.jpg 485w,\n/blog/static/d004f695f0a868e2c3bd438c83a6ba0a/ec7ce/relational_store.jpg 970w,\n/blog/static/d004f695f0a868e2c3bd438c83a6ba0a/8010b/relational_store.jpg 1455w,\n/blog/static/d004f695f0a868e2c3bd438c83a6ba0a/f32bc/relational_store.jpg 1940w,\n/blog/static/d004f695f0a868e2c3bd438c83a6ba0a/a1107/relational_store.jpg 2266w\"\n            sizes=\"(max-width: 970px) 100vw, 970px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/blog/static/d004f695f0a868e2c3bd438c83a6ba0a/ec7ce/relational_store.jpg\"\n            alt=\"Relational_Store\"\n            title=\"Relational_Store\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\nBut in Hbase, data for a column is stored together. For a key (UniversitySudentNumber), if you find the Branch information, you will see that the next block on the disk contains Branch information for some other student. The City information of the student might reside somewhere else.\n<img src=\"./columnal_store.png\" alt=\"Columnal_Store\"></p>\n<p>You can store a few columns together by grouping them together into <code class=\"language-text\">ColumnFamilies</code>. If we had to group columns in our student database, we might choose to group columns related to personal information such as Home Address, Parent's name into one column family. The information related to the college, course can be grouped into another column family. This way, you bring in a little bit of structure to the NoSQL datastore.</p>\n<h1>Hbase runs on Hadoop</h1>\n<p>Hadoop, as we know is just a large distributed file system. Hbase uses it to store data as files (they are called Hfiles, really). Does that mean I can spin up a Hbase database from a large amount of data I have on my Hadoop cluster? No! Hbase requires that you start with an empty database. It will then insert data into this database as it sees fit.</p>\n<h1>Hbase has Name Nodes and Data Nodes</h1>\n<p>Name nodes and Data nodes are terms from Hadoop, really. Datanodes are the place to store your data (usually they have TBs of disk). Namenodes keep a map to tell you which datanode has the data you need. When Hbase wants to store or retrieve the data, it talks to the name node to identify the datanode to read/write, then does the actual read/write operation on the Data node.</p>\n<h1>Hbase Region Servers</h1>\n<p>If you have a Java application that uses Hbase, the client that runs in the application talks to Hbase region servers. Region servers are processes that keep data in memory. Once the memory is full, they flush the data to the data nodes. They also read Hfiles from data nodes and store in memory to serve the read operations from your application. Each region server is responsible for a range of keys (Remember Hbase is a key-value store?)</p>\n<h1>Hbase master or HMaster</h1>\n<p>There are so many region servers. How does your application know which region server to connect? There is a single Hmaster (with a backup) to get map of Region servers and the range of keys they serve. Usually this map is cached by your application and is refreshed periodically.</p>\n<h1>Hbase works with ZooKeeper</h1>\n<p>Your application gets information of region servers and the key range they serve from HMaster. But how does it know which is the HMaster machine? This information is stored in Zookeeper. How does HMaster know what region servers are present in the cluster? This information is also in Zookeeper. And, Hadoop keeps the information on the datanodes in Zookeeper as well.</p>\n<h1>Hbase keeps data in sorted order</h1>\n<p>Hbase keeps data in Hfiles. Initially the Hfiles is stored in memory. As you add data to the database, the keys are added to the Hfiles in sorted order. Once the Hfiles gets full, it is written to the disk (in the data node). If you want to add a new key, the full Hfiles where the key should belong is read into the memory, the new key is added to the sorted place where it belongs and the updated full Hfiles is written to the disk again. The previously written Hfiles is no longer used (it will be cleaned up by a different process).\nThis is why it is easy to look up keys in Hbase. Given the key, you will know exactly which Hfiles to search (because they are all sorted and the ranges are indexed in the HMaster).</p>\n<h1>Compaction</h1>\n<p>A <code class=\"language-text\">minor compaction</code> runs several times a day to merge smaller Hfiles into larger Hfiles. This reduces the number of files that needs to be read thus improving performance.\nWhen you delete a key, it is simply marked \"to-be-deleted\". When the Hfile gets too big, it needs to be split into two HFiles and the ranges need to be updated. A <code class=\"language-text\">major compaction</code> process runs periodically to copy the data to new HFiles by excluding keys that are deleted or expired. It also balances the \"regions\" (key ranges) managed by the region servers. This is a heavy operation and can impact the performance of the system.</p>","fields":{"slug":"/basics-of-hbase/"},"frontmatter":{"title":"Basics of Hbase","date":"2021, Nov 25","tags":["tech","hbase","no-sql"],"memorydata":null,"practicedata":null,"img":{"childImageSharp":{"resize":{"src":"/static/b224944c53b8bae91b825e939404e76d/47498/basics_hbase.jpg","height":458,"width":1200},"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3KCgf//EABgQAAIDAAAAAAAAAAAAAAAAAAARAQIx/9oACAEBAAEFArNRh//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABcQAAMBAAAAAAAAAAAAAAAAAAAQISL/2gAIAQEABj8CyVf/xAAYEAEAAwEAAAAAAAAAAAAAAAABABARcf/aAAgBAQABPyHuTQBa1//aAAwDAQACAAMAAAAQiA//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAZEAEBAAMBAAAAAAAAAAAAAAABEQAQQVH/2gAIAQEAAT8QQkC2V4e5cDszX//Z"},"images":{"fallback":{"src":"/blog/static/b224944c53b8bae91b825e939404e76d/142db/basics_hbase.jpg","srcSet":"/blog/static/b224944c53b8bae91b825e939404e76d/73628/basics_hbase.jpg 750w,\n/blog/static/b224944c53b8bae91b825e939404e76d/4c65c/basics_hbase.jpg 1080w,\n/blog/static/b224944c53b8bae91b825e939404e76d/e5c4d/basics_hbase.jpg 1366w,\n/blog/static/b224944c53b8bae91b825e939404e76d/142db/basics_hbase.jpg 1920w","sizes":"100vw"},"sources":[{"srcSet":"/blog/static/b224944c53b8bae91b825e939404e76d/ec25a/basics_hbase.avif 750w,\n/blog/static/b224944c53b8bae91b825e939404e76d/5de3b/basics_hbase.avif 1080w,\n/blog/static/b224944c53b8bae91b825e939404e76d/bc222/basics_hbase.avif 1366w,\n/blog/static/b224944c53b8bae91b825e939404e76d/fe81c/basics_hbase.avif 1920w","type":"image/avif","sizes":"100vw"},{"srcSet":"/blog/static/b224944c53b8bae91b825e939404e76d/9c118/basics_hbase.webp 750w,\n/blog/static/b224944c53b8bae91b825e939404e76d/6156b/basics_hbase.webp 1080w,\n/blog/static/b224944c53b8bae91b825e939404e76d/cb4c9/basics_hbase.webp 1366w,\n/blog/static/b224944c53b8bae91b825e939404e76d/17eea/basics_hbase.webp 1920w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.3817708333333333}}}}}},"pageContext":{"slug":"/basics-of-hbase/","previous":{"fields":{"slug":"/service_mesh/"},"frontmatter":{"title":"Service Mesh and Micro Services","tags":["tech","kubernetes","service-mesh","micro-service","istio"],"img":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAFABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAP/2gAMAwEAAhADEAAAAdekaAf/xAAWEAADAAAAAAAAAAAAAAAAAAABECH/2gAIAQEAAQUCNf8A/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAFhABAQEAAAAAAAAAAAAAAAAAEQEQ/9oACAEBAAE/IYAm/wD/2gAMAwEAAgADAAAAEAff/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGBABAAMBAAAAAAAAAAAAAAAAAQAQYRH/2gAIAQEAAT8QXiWiBrX/2Q=="},"images":{"fallback":{"src":"/blog/static/e5e26c109e33630b93c1754c4191e14c/d3163/service_mesh.jpg","srcSet":"/blog/static/e5e26c109e33630b93c1754c4191e14c/37f21/service_mesh.jpg 750w,\n/blog/static/e5e26c109e33630b93c1754c4191e14c/c1ea9/service_mesh.jpg 1080w,\n/blog/static/e5e26c109e33630b93c1754c4191e14c/e680c/service_mesh.jpg 1366w,\n/blog/static/e5e26c109e33630b93c1754c4191e14c/d3163/service_mesh.jpg 1920w","sizes":"100vw"},"sources":[{"srcSet":"/blog/static/e5e26c109e33630b93c1754c4191e14c/3656b/service_mesh.webp 750w,\n/blog/static/e5e26c109e33630b93c1754c4191e14c/33974/service_mesh.webp 1080w,\n/blog/static/e5e26c109e33630b93c1754c4191e14c/32772/service_mesh.webp 1366w,\n/blog/static/e5e26c109e33630b93c1754c4191e14c/6156c/service_mesh.webp 1920w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.2598958333333333}}}}},"next":{"fields":{"slug":"/the-startup-of-you/"},"frontmatter":{"title":"The Startup Of You - Reid Hoffman and Ben Casnocha","tags":["review","book","non-fiction"],"img":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAGABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIF/8QAFwEAAwEAAAAAAAAAAAAAAAAAAAEDBP/aAAwDAQACEAMQAAAB14KZ7Av/xAAXEAADAQAAAAAAAAAAAAAAAAAAAhAh/9oACAEBAAEFAhcn/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAGBABAAMBAAAAAAAAAAAAAAAAAQARIRD/2gAIAQEAAT8hgRS3rvP/2gAMAwEAAgADAAAAEHg//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGhAAAgIDAAAAAAAAAAAAAAAAAREhMQAQgf/aAAgBAQABPxAtReFpUxizJa5Wv//Z"},"images":{"fallback":{"src":"/blog/static/91a9368e0275e3013716bd618b65ab3c/f8f65/startup_title.jpg","srcSet":"/blog/static/91a9368e0275e3013716bd618b65ab3c/64bad/startup_title.jpg 750w,\n/blog/static/91a9368e0275e3013716bd618b65ab3c/33e41/startup_title.jpg 1080w,\n/blog/static/91a9368e0275e3013716bd618b65ab3c/c4a29/startup_title.jpg 1366w,\n/blog/static/91a9368e0275e3013716bd618b65ab3c/f8f65/startup_title.jpg 1920w","sizes":"100vw"},"sources":[{"srcSet":"/blog/static/91a9368e0275e3013716bd618b65ab3c/28c13/startup_title.webp 750w,\n/blog/static/91a9368e0275e3013716bd618b65ab3c/12a82/startup_title.webp 1080w,\n/blog/static/91a9368e0275e3013716bd618b65ab3c/9454a/startup_title.webp 1366w,\n/blog/static/91a9368e0275e3013716bd618b65ab3c/0e53e/startup_title.webp 1920w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.315625}}}}}}},"staticQueryHashes":["251720178","764694655"]}