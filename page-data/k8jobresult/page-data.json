{"componentChunkName":"component---src-templates-blog-post-js","path":"/k8jobresult/","result":{"data":{"site":{"siteMetadata":{"title":"Aparna's Personal Space","author":"Aparna Ravindra"}},"markdownRemark":{"id":"a2c0027a-558e-5906-8fbb-03c0fa6ae991","excerpt":"How to Publish Kubernetes Job Results Without Persistent Storage Kubernetes Jobs are great for one-off workloads — running tests, data processing, or batch…","html":"<h1>How to Publish Kubernetes Job Results Without Persistent Storage</h1>\n<p>Kubernetes Jobs are great for one-off workloads — running tests, data processing, or batch scripts.<br>\nBut they come with a catch: as soon as the Job finishes, the pod is terminated.<br>\nIf you rely only on ephemeral storage, all your results disappear instantly.</p>\n<p>So, what are the options? One reddit thread summarized this well here - <a href=\"https://www.reddit.com/r/kubernetes/comments/yls8jf/simplest_way_to_retrieve_job_results/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://www.reddit.com/r/kubernetes/comments/yls8jf/simplest_way_to_retrieve_job_results/</a></p>\n<ol>\n<li>Push the results to a blob storage.</li>\n<li>Mount a PVC and run another pod with same PVC to fetch the results later.</li>\n<li>Expose a rest endpoint somewhere. Make the job push the results to the endpoint after completion.</li>\n<li>Write the results to container logs.</li>\n</ol>\n<p>But, 2 out of the 4 options (blob storage and PVC) need an external dependency in terms of storage. The next option requires maintenance of a server to receive the results when ready. The last option is not neat (in my opinion).\nSo, if I only have a CI/CD system that triggers the K8 job and I don't really care about peristing the results for later (I only need to evaluate the result and signal a pass/fail in the CI pipeline), what is the solution that does not have an overhead of external systems or extra storage?</p>\n<p>That’s exactly the situation I found myself in.<br>\nHere’s what I learned about publishing results from ephemeral Kubernetes Jobs without relying on persistent volumes.</p>\n<h2>Typical Setup</h2>\n<p>A Kubernetes Job runs a container like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> batch/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Job\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> test<span class=\"token punctuation\">-</span>runner\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> runner\n          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> my<span class=\"token punctuation\">-</span>test<span class=\"token punctuation\">-</span>image\n          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"./run-tests.sh\"</span><span class=\"token punctuation\">]</span>\n          <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> temp\n              <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /results\n      <span class=\"token key atrule\">restartPolicy</span><span class=\"token punctuation\">:</span> Never\n      <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> temp\n          <span class=\"token key atrule\">emptyDir</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>Here, /results is an emptyDir volume — ephemeral, lost when the pod dies.</p>\n<p>When the Job completes, both the pod and volume are deleted — leaving you no chance to copy out the test results.</p>\n<h2>The Challenge</h2>\n<p>I needed a way to capture the results file (about 2 MB) without:</p>\n<p>Persistent Volumes</p>\n<p>Access to the node filesystem</p>\n<p>External storage services (like S3 or Azure Blob)</p>\n<p>And since the container terminated immediately, I couldn’t just kubectl cp the file out manually.</p>\n<p>So the question became: How do I make the results \"leave\" the pod before it terminates?</p>\n<h2>What Worked For Me</h2>\n<p>In my setup, I used a sidecar container that stayed alive for a few minutes after the main container completed.</p>\n<p>Here’s how it worked:\nMy setup already involved a side car doing some stuff (read about it here - <a href=\"https://joshi-aparna.github.io/blog/k8sidecar/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://joshi-aparna.github.io/blog/k8sidecar/</a>). I had to take advantage of this fact.</p>\n<p>The main container ran tests and wrote results to a shared emptyDir volume.</p>\n<p>The sidecar used a preStop hook with a sleep delay — keeping it alive for about 5 minutes after the Job finished.</p>\n<p>An external system (the CI system, in my case) continuously polled Kubernetes for Job status. Once it detected the main container had completed, it connected to the sidecar and pulled the results from the shared volume.</p>\n<p>This approach let me reliably extract results without persistent storage or third-party services.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> runner\n      <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> my<span class=\"token punctuation\">-</span>test<span class=\"token punctuation\">-</span>image\n      <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"./run-tests.sh\"</span><span class=\"token punctuation\">]</span>\n      <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> shared\n          <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /results\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> sidecar\n      <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> busybox\n      <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"sh\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"-c\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"while true; do sleep 5; done\"</span><span class=\"token punctuation\">]</span> <span class=\"token comment\"># placeholder code</span>\n      <span class=\"token key atrule\">lifecycle</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">preStop</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">exec</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> powershell\n            <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span>Command\n            <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n              Write-Host 'preStop: allowing 5m for log flush'; Start-Sleep -Seconds 300</span>\n      <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> shared\n          <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /results\n  <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> shared\n      <span class=\"token key atrule\">emptyDir</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>It was simple, self-contained, and resilient — even when job durations varied.\nThe five-minute grace period gave the external collector enough time to fetch results before Kubernetes cleaned up the pod.</p>\n<h2>Key Takeaways</h2>\n<p>Ephemeral ≠ inaccessible — results can be retrieved with smart lifecycle control.</p>\n<p>Use sidecars and preStop hooks to add a short grace period for collection.</p>\n<p>What other approaches could work in a scenario like this?</p>","fields":{"slug":"/k8jobresult/"},"frontmatter":{"title":"Fetch K8 Job Result without Persistent Storage","date":"2025, Oct 07","tags":["tech"],"memorydata":null,"practicedata":null,"img":{"childImageSharp":{"resize":{"src":"/static/78c76ca0c206b2edc49f02d4adf92e04/f3583/k8job.png","height":800,"width":1200},"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAACCklEQVQoz32SXVPaQBSG+Ye9a/9Lb3rjD+hFO7UWRik6Ai0hISEhIQHB8BEQR9EYQgIUQjb7kQ+lOt51OiKm1s505ly8u2efc3bPvgkAoet5rucBCBEhsX4RrudBjB5FvJkAEEKEMCGQEGs69cMQYvwvjAieLRZL4CGMYz6xBGC+WLS63XdbW69ev9lOJS90HT478VAdo5OzISMopYpiTibr7BP8aecLw7FaX1MUedDTKtWqH4ZLADYkQj8cp8jLpj3tDs4qtSYiT3B0c7ObyWwnd+7vfs4Dtz/XZaVGgiDu7CE0dxyKkwbnl63eqVg/jt+VwL6vj0bvP374dX8ng/O3J4eCKBI/cFx3CcASAMd1IUKnw0umorBizZrOIEIb2PU8RIggSVVFlo8bBZHrDwar21tEiB9FfhjGQYIgiKIgCr0YJkGg9fs0y30rFg+yWYqmS2W+QNMNVU2l06VyWZCk/VxWrtcZlhNlmeMF07YfJ5qAGJu2rXa7kqLwksgKvNrp0CxXrdcaqsqLonx0JNfqarvd1rRmq9VstcbrgW/+2UPoerUa6vphPp8vUAfZ3OdkKve9kKeovcz+7tdMp9ejGCa1lzZM83q1+nPt2DST2cy0bNO2Lq6udMMY27ZpWcZ4rBvGgzBNfTSaO85zkyWeuQ8jQhAh2PfxWsTLOBX3/AuOHf7/eOHZ3y0Okb+DObKaAAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/blog/static/78c76ca0c206b2edc49f02d4adf92e04/6e90d/k8job.png","srcSet":"/blog/static/78c76ca0c206b2edc49f02d4adf92e04/ea847/k8job.png 750w,\n/blog/static/78c76ca0c206b2edc49f02d4adf92e04/4a806/k8job.png 1080w,\n/blog/static/78c76ca0c206b2edc49f02d4adf92e04/e2aad/k8job.png 1366w,\n/blog/static/78c76ca0c206b2edc49f02d4adf92e04/6e90d/k8job.png 1536w","sizes":"100vw"},"sources":[{"srcSet":"/blog/static/78c76ca0c206b2edc49f02d4adf92e04/b0356/k8job.avif 750w,\n/blog/static/78c76ca0c206b2edc49f02d4adf92e04/48f75/k8job.avif 1080w,\n/blog/static/78c76ca0c206b2edc49f02d4adf92e04/a5094/k8job.avif 1366w,\n/blog/static/78c76ca0c206b2edc49f02d4adf92e04/b30f5/k8job.avif 1536w","type":"image/avif","sizes":"100vw"},{"srcSet":"/blog/static/78c76ca0c206b2edc49f02d4adf92e04/57584/k8job.webp 750w,\n/blog/static/78c76ca0c206b2edc49f02d4adf92e04/984df/k8job.webp 1080w,\n/blog/static/78c76ca0c206b2edc49f02d4adf92e04/4a276/k8job.webp 1366w,\n/blog/static/78c76ca0c206b2edc49f02d4adf92e04/7db9c/k8job.webp 1536w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.6666666666666666}}}}}},"pageContext":{"slug":"/k8jobresult/","previous":{"fields":{"slug":"/azurearc_auth/"},"frontmatter":{"title":"Authentication in Azure Arc-Enabled Servers","tags":["tech"],"img":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAACSUlEQVQoz2WSS3PSUBTHu3X8DrrzA+hSP4Ku3Dije1cudOFG7UJdyMKuXDDqWHzUwqCApQyPFgqUYnhDAoGQQiQhyQ3PPKHJ5eHwGFpx5szce8+9v3Pn/P9noykZi6BFnVOgoI1ZGQqDCadATl4egTpuSgYrQ0Y0Vu+bkrGxWNj5nTWIffPnrUHUFsLsR0XbfPPVn/MgpAchwyjdHk4YUV+HGVFPVsHeCfEzUnJESx6EtIWwX7GK67i8G0QD6fphlgqk62VO5hS44pcwr0B3nHDFyhGUdser3w8KZieyE8h7k6e2EGYLYY4obj8qhlFa0MbrcKHRy9Y7ZVbKUZ0s1aH7uqCNeRXy6gioI3k85RUjRQqkoPLq6BxmZUh1h66TSqbWsnizsRIbyNQTBJiLpFPdQaN39mE//XL7IIazgQxVFVROhkuYUyApaHmqRQLx4ZsfFl+uPYCJKmAlAyFAFSi/CXD9vunGA5M9gpeaYiBDtQZL2ZY/f/blPnkyZlfixXv/tjeDEKDCyx/3UrWWlqgK1+6+unpnc8t6nCKFUrM/02zVM6fALVvs0VvHldub955/efpuH6P7JFDq7UHnbBqv8JduPr5868luCJNG04U154IxotE3po3e0LQT9qVqEpyuuuKVUZHpv7YEn5m9MZxlRONPd/iPz5wCy5zsjOIRlPYmT8MoDeZ+MKIOtHGCAOF8I1xoOCO4M4qXOWlu9QWrZiVkOJtQGXIKXCUZURe0CVLh3XHiMEutDenGxVldtLCWmQOz+D//F+FlnCD+jHAlAAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/blog/static/f1d71e1472b70f5a2bce37a1c6096f9c/6e90d/arc_auth.png","srcSet":"/blog/static/f1d71e1472b70f5a2bce37a1c6096f9c/ea847/arc_auth.png 750w,\n/blog/static/f1d71e1472b70f5a2bce37a1c6096f9c/4a806/arc_auth.png 1080w,\n/blog/static/f1d71e1472b70f5a2bce37a1c6096f9c/e2aad/arc_auth.png 1366w,\n/blog/static/f1d71e1472b70f5a2bce37a1c6096f9c/6e90d/arc_auth.png 1536w","sizes":"100vw"},"sources":[{"srcSet":"/blog/static/f1d71e1472b70f5a2bce37a1c6096f9c/57584/arc_auth.webp 750w,\n/blog/static/f1d71e1472b70f5a2bce37a1c6096f9c/984df/arc_auth.webp 1080w,\n/blog/static/f1d71e1472b70f5a2bce37a1c6096f9c/4a276/arc_auth.webp 1366w,\n/blog/static/f1d71e1472b70f5a2bce37a1c6096f9c/7db9c/arc_auth.webp 1536w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.6666666666666666}}}}},"next":null}},"staticQueryHashes":["251720178","764694655"]}